{"ast":null,"code":"\"use strict\";\n\nvar _objectSpread = require(\"C:\\\\Users\\\\muska\\\\OneDrive\\\\Desktop\\\\NotesApp\\\\node_modules\\\\@babel\\\\runtime/helpers/objectSpread2\");\n\nvar _classCallCheck = require(\"C:\\\\Users\\\\muska\\\\OneDrive\\\\Desktop\\\\NotesApp\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:\\\\Users\\\\muska\\\\OneDrive\\\\Desktop\\\\NotesApp\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\n\nvar _inherits = require(\"C:\\\\Users\\\\muska\\\\OneDrive\\\\Desktop\\\\NotesApp\\\\node_modules\\\\@babel\\\\runtime/helpers/inherits\");\n\nvar _createSuper = require(\"C:\\\\Users\\\\muska\\\\OneDrive\\\\Desktop\\\\NotesApp\\\\node_modules\\\\@babel\\\\runtime/helpers/createSuper\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CommandOperation = void 0;\n\nvar error_1 = require(\"../error\");\n\nvar explain_1 = require(\"../explain\");\n\nvar read_concern_1 = require(\"../read_concern\");\n\nvar server_selection_1 = require(\"../sdam/server_selection\");\n\nvar utils_1 = require(\"../utils\");\n\nvar write_concern_1 = require(\"../write_concern\");\n\nvar operation_1 = require(\"./operation\");\n\nvar SUPPORTS_WRITE_CONCERN_AND_COLLATION = 5;\n/** @internal */\n\nvar CommandOperation = /*#__PURE__*/function (_operation_1$Abstract) {\n  _inherits(CommandOperation, _operation_1$Abstract);\n\n  var _super = _createSuper(CommandOperation);\n\n  function CommandOperation(parent, options) {\n    var _this;\n\n    _classCallCheck(this, CommandOperation);\n\n    _this = _super.call(this, options);\n    _this.options = options !== null && options !== void 0 ? options : {}; // NOTE: this was explicitly added for the add/remove user operations, it's likely\n    //       something we'd want to reconsider. Perhaps those commands can use `Admin`\n    //       as a parent?\n\n    var dbNameOverride = (options === null || options === void 0 ? void 0 : options.dbName) || (options === null || options === void 0 ? void 0 : options.authdb);\n\n    if (dbNameOverride) {\n      _this.ns = new utils_1.MongoDBNamespace(dbNameOverride, '$cmd');\n    } else {\n      _this.ns = parent ? parent.s.namespace.withCollection('$cmd') : new utils_1.MongoDBNamespace('admin', '$cmd');\n    }\n\n    _this.readConcern = read_concern_1.ReadConcern.fromOptions(options);\n    _this.writeConcern = write_concern_1.WriteConcern.fromOptions(options); // TODO(NODE-2056): make logger another \"inheritable\" property\n\n    if (parent && parent.logger) {\n      _this.logger = parent.logger;\n    }\n\n    if (_this.hasAspect(operation_1.Aspect.EXPLAINABLE)) {\n      _this.explain = explain_1.Explain.fromOptions(options);\n    } else if ((options === null || options === void 0 ? void 0 : options.explain) != null) {\n      throw new error_1.MongoInvalidArgumentError(\"Option \\\"explain\\\" is not supported on this command\");\n    }\n\n    return _this;\n  }\n\n  _createClass(CommandOperation, [{\n    key: \"canRetryWrite\",\n    get: function get() {\n      if (this.hasAspect(operation_1.Aspect.EXPLAINABLE)) {\n        return this.explain == null;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"executeCommand\",\n    value: function executeCommand(server, session, cmd, callback) {\n      // TODO: consider making this a non-enumerable property\n      this.server = server;\n\n      var options = _objectSpread(_objectSpread(_objectSpread({}, this.options), this.bsonOptions), {}, {\n        readPreference: this.readPreference,\n        session: session\n      });\n\n      var serverWireVersion = (0, utils_1.maxWireVersion)(server);\n      var inTransaction = this.session && this.session.inTransaction();\n\n      if (this.readConcern && (0, utils_1.commandSupportsReadConcern)(cmd) && !inTransaction) {\n        Object.assign(cmd, {\n          readConcern: this.readConcern\n        });\n      }\n\n      if (this.trySecondaryWrite && serverWireVersion < server_selection_1.MIN_SECONDARY_WRITE_WIRE_VERSION) {\n        options.omitReadPreference = true;\n      }\n\n      if (options.collation && serverWireVersion < SUPPORTS_WRITE_CONCERN_AND_COLLATION) {\n        callback(new error_1.MongoCompatibilityError(\"Server \".concat(server.name, \", which reports wire version \").concat(serverWireVersion, \", does not support collation\")));\n        return;\n      }\n\n      if (this.writeConcern && this.hasAspect(operation_1.Aspect.WRITE_OPERATION) && !inTransaction) {\n        Object.assign(cmd, {\n          writeConcern: this.writeConcern\n        });\n      }\n\n      if (serverWireVersion >= SUPPORTS_WRITE_CONCERN_AND_COLLATION) {\n        if (options.collation && typeof options.collation === 'object' && !this.hasAspect(operation_1.Aspect.SKIP_COLLATION)) {\n          Object.assign(cmd, {\n            collation: options.collation\n          });\n        }\n      }\n\n      if (typeof options.maxTimeMS === 'number') {\n        cmd.maxTimeMS = options.maxTimeMS;\n      }\n\n      if (this.hasAspect(operation_1.Aspect.EXPLAINABLE) && this.explain) {\n        if (serverWireVersion < 6 && cmd.aggregate) {\n          // Prior to 3.6, with aggregate, verbosity is ignored, and we must pass in \"explain: true\"\n          cmd.explain = true;\n        } else {\n          cmd = (0, utils_1.decorateWithExplain)(cmd, this.explain);\n        }\n      }\n\n      server.command(this.ns, cmd, options, callback);\n    }\n  }]);\n\n  return CommandOperation;\n}(operation_1.AbstractOperation);\n\nexports.CommandOperation = CommandOperation;","map":null,"metadata":{},"sourceType":"script"}